(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{217:function(e,t,r){"use strict";r.r(t);r(2);var a=r(7),n=(r(10),r(36)),o=r(242);function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function s(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var u={mixins:[n.b],components:{ModelForm:o.a},data:function(){return{isCreating:!1,model:null,items:[],pagination:null,formData:null}},beforeRouteEnter:function(e,t,r){return r((function(e){return e.lock(e.view())}))},beforeRouteUpdate:function(e,t,r){e.params.scheduleId!==t.params.scheduleId&&this.lock(this.view(e.params.scheduleId)),r()},computed:{backRoute:function(){return{name:"schedules.list"}}},methods:function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(r,!0).forEach((function(t){s(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({toggleCreateMode:function(){this.$data.isCreating=!this.$data.isCreating},onChangePage:function(e){this.$filters("schedules").data.page=e,this.view()},assignedAt:function(e){return e.assigned_at+" "+e.excursion.time}},Object(a.mapActions)("schedules",{view:function(e){var t,r,a,n,o,i=arguments;return regeneratorRuntime.async((function(s){for(;;)switch(s.prev=s.next){case 0:return t=i.length>1&&void 0!==i[1]?i[1]:null,s.next=3,regeneratorRuntime.awrap(e("view",{scheduleId:t||this.$routeParam("scheduleId")}));case 3:r=s.sent,a=r.view,n=r.items,o=r.pagination,this.$data.model=a,this.$data.items=n,this.$data.pagination=o,this.$data.formData={user_id:a.id,tour_id:parseInt(this.$routeParam("tourId"))};case 11:case"end":return s.stop()}}),null,this)},destroy:function(e,t){var r=this;return regeneratorRuntime.async((function(a){for(;;)switch(a.prev=a.next){case 0:this.$vConfirmDelete(this.$t("Do you confirm deleting session?")).then((function(){e("destroy",{scheduleId:t.id}),r.view(),r.$ee.emit("schedules@list.fetch"),r.$ee.emit("schedules@view.fetch")})).catch((function(e){console.log("Deleting canceled")}));case 1:case"end":return a.stop()}}),null,this)},store:function(e,t){var r,a,n,o=arguments;return regeneratorRuntime.async((function(i){for(;;)switch(i.prev=i.next){case 0:return r=o.length>2&&void 0!==o[2]&&o[2],i.next=3,regeneratorRuntime.awrap(e("store",{form:t}));case 3:return a=i.sent,n=a.form,i.next=7,regeneratorRuntime.awrap(t.setData(n));case 7:return r?t.setData({}):this.toggleCreateMode(),i.next=10,regeneratorRuntime.awrap(this.view());case 10:this.$ee.emit("schedules@list.fetch"),this.$ee.emit("schedules@view.fetch");case 12:case"end":return i.stop()}}),null,this)}}))},l=r(1),c=Object(l.a)(u,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-sidebar-layout",{attrs:{locked:e.locked},scopedSlots:e._u([{key:"header",fn:function(){return[r("v-sidebar-layout-header",{attrs:{title:e.$t("Session detail page"),"back-route":e.backRoute},scopedSlots:e._u([{key:"right",fn:function(){return[!e.isCreating&&e.$can("schedules.create")?r("button",{staticClass:"btn",attrs:{"aria-label":e.$t("Add"),type:"button"},on:{click:e.toggleCreateMode}},[r("i",{staticClass:"c-icon-add2"})]):e._e()]},proxy:!0}])})]},proxy:!0},{key:"body",fn:function(){return[r("v-form-preview",{attrs:{label:e.$t("User"),value:e.model.first_name+" "+e.model.last_name}}),e._v(" "),e.isCreating?r("div",{staticClass:"mb-20"},[r("v-form",{ref:"form",attrs:{data:e.formData,name:"schedules"},on:{submit:e.store},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.form,n=t.submit;return[r("model-form",{attrs:{users:[e.model],form:a},on:{submit:n}},[r("el-button",{attrs:{type:"success","native-type":"submit"}},[e._v(e._s(e.$t("Create"))+"\n                    ")]),e._v(" "),r("el-button",{on:{click:e.toggleCreateMode}},[e._v(e._s(e.$t("Cancel"))+"\n                    ")])],1)]}}],null,!1,3502570467)})],1):e._e(),e._v(" "),r("v-content-list",{attrs:{items:e.items,pagination:e.pagination,unbox:""},on:{"change-page":e.onChangePage},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.item;return[r("v-list-item",{key:a.id,attrs:{data:a,"title-by":e.assignedAt,"description-by":"tour.name"},scopedSlots:e._u([{key:"aside",fn:function(){return[r("div",{staticClass:"c-list__aside"},[r("div",{staticClass:"c-list__aside-item"},[e.$can("schedules.delete")?r("el-button",{attrs:{type:"text",icon:"fal fa-trash-alt"},on:{click:function(t){return e.destroy(a)}}}):e._e()],1)])]},proxy:!0}],null,!0)})]}}])})]},proxy:!0},{key:"footer",fn:function(){},proxy:!0}])})}),[],!1,null,null,null);t.default=c.exports},242:function(e,t,r){"use strict";var a={props:{users:{type:Array,required:!0},form:{type:Object,required:!0},disabled:{type:Boolean,default:!1}},data:function(){return{lock:!0,term:""}},computed:{fetchToursUrl:function(){return"schedules/tours-autocomplete"},fetchExcursionrUrl:function(){return"schedules/".concat(this.form.data.tour_id,"/date-autocomplete")}},methods:{onChangeDay:function(){this.form.data.assigned_at=null},onChangeTime:function(e){var t=this,r=e.find((function(e){return e.id==t.form.data.excursion_id}));this.form.data.assigned_at=r.date_time},onSubmit:function(){this.$emit("submit",this.$props.form,!0)},toggle:function(){this.$data.lock=!this.$data.lock}}},n=r(1),o=Object(n.a)(a,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-form",{attrs:{disabled:e.disabled,"label-position":"top"},nativeOn:{submit:function(t){return t.preventDefault(),e.onSubmit(t)}}},[r("el-form-item",{attrs:{label:e.$t("Tour"),error:e.form.formatErrors("tour_id")}},[r("v-autocomplete",{attrs:{id:"tours",url:e.fetchToursUrl},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.items;t.fetching;return[r("el-select",{attrs:{placeholder:e.$t("Tour"),disabled:!0},model:{value:e.form.data.tour_id,callback:function(t){e.$set(e.form.data,"tour_id",t)},expression:"form.data.tour_id"}},e._l(a,(function(e){return r("el-option",{key:"tour_"+e.id,attrs:{label:e.name,value:e.id}})})),1)]}}])})],1),e._v(" "),r("el-form-item",{attrs:{label:e.$t("User"),error:e.form.formatErrors("user_id")}},[r("el-select",{attrs:{placeholder:e.$t("User"),disabled:!0},model:{value:e.form.data.user_id,callback:function(t){e.$set(e.form.data,"user_id",t)},expression:"form.data.user_id"}},e._l(e.users,(function(e){return r("el-option",{key:"user_"+e.id,attrs:{label:e.first_name+" "+e.last_name,value:e.id}})})),1)],1),e._v(" "),r("el-form-item",{attrs:{label:e.$t("Day"),error:e.form.formatErrors("excursion_id")}},[r("v-autocomplete",{attrs:{id:"excursion_list",url:e.fetchExcursionrUrl,disabled:!e.form.data.tour_id},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.items;t.fetching;return[r("el-select",{attrs:{placeholder:e.$t("Select"),disabled:!e.form.data.tour_id},on:{change:e.onChangeDay},model:{value:e.form.data.day,callback:function(t){e.$set(e.form.data,"day",t)},expression:"form.data.day"}},e._l(a,(function(e){return r("el-option",{key:"e_"+e[0].id,attrs:{label:e[0].day_title,value:e[0].day}})})),1)]}}])})],1),e._v(" "),r("el-form-item",{attrs:{label:e.$t("Time"),error:e.form.formatErrors("assigned_at")}},[r("v-autocomplete",{attrs:{id:"excursion_time",url:e.fetchExcursionrUrl,disabled:!e.form.data.tour_id},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.items;t.fetching;return[r("el-select",{attrs:{placeholder:e.$t("Select"),disabled:!e.form.data.tour_id},on:{change:function(t){e.onChangeTime(a.find((function(t){return t[0].day==e.form.data.day})))}},model:{value:e.form.data.excursion_id,callback:function(t){e.$set(e.form.data,"excursion_id",t)},expression:"form.data.excursion_id"}},e._l(a.find((function(t){return t[0].day==e.form.data.day})),(function(e){return r("el-option",{key:"time_"+e.id,attrs:{label:e.time,value:e.id}})})),1)]}}])})],1),e._v(" "),r("v-divider"),e._v(" "),e._t("default")],2)}),[],!1,null,null,null);t.a=o.exports}}]);