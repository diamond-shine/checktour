(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{199:function(e,t,r){"use strict";r.r(t);var o=r(7),s=(r(10),r(36)),i=(r(2),r(5));function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var l={props:{form:{type:Object,required:!0}},data:function(){return{forms:null,selected:null,scheduleId:null,commentForm:!1,schedules:[]}},computed:function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(r,!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},Object(o.mapState)("system",["user"]),{isChanged:function(){return this.$props.form.changed("schedule_id")||this.$props.form.changed("arrived_waiting_room")},enabledForRostering:function(){return!(!this.$props.form.data||!this.$props.form.data.arrived_waiting_room)&&(!this.$props.form.data.schedule||(this.$props.form.data.schedule.user_id==this.user.id||this.$can("rosters.permit")))},isProcessed:function(){return!(!this.$props.form.data||!this.$props.form.data.schedule)&&this.$props.form.data.schedule.is_finished}}),methods:{fetchSchedules:function(){var e,t;return regeneratorRuntime.async((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,regeneratorRuntime.awrap(this.$taskManager.run("autocomplete@schedule.fetch",i.a.get("bookings/autocomplete?tour_id="+this.form.data.tour_id)));case 2:e=r.sent,t=e.data.data,this.schedules=t.items;case 5:case"end":return r.stop()}}),null,this)},autoAssign:function(){this.schedules.length&&this.form.data.arrived_waiting_room&&!this.$props.form.data.schedule_id&&(this.$props.form.data.schedule_id=this.schedules[0].id)},onSubmit:function(){this.$emit("submit",this.$props.form)},attachSelected:function(e){var t=this;return!!this.$props.form.data&&(!!this.$props.form.data.schedule_id&&!e.find((function(e){return e.id==t.$props.form.data.schedule_id})))}},beforeMount:function(){this.scheduleId=this.$props.form.data.schedule_id,this.fetchSchedules()}},c=r(1),m=Object(c.a)(l,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-form",{attrs:{"label-position":"top"},nativeOn:{submit:function(t){return t.preventDefault(),e.onSubmit(t)}}},[r("el-form-item",{attrs:{error:e.form.formatErrors("tour_id")}},[r("el-select",{attrs:{placeholder:e.$t("Assign guide / time"),disabled:e.isProcessed||!e.enabledForRostering},model:{value:e.form.data.schedule_id,callback:function(t){e.$set(e.form.data,"schedule_id",t)},expression:"form.data.schedule_id"}},[r("el-option",{attrs:{label:e.$t("Not selected"),value:null}}),e._v(" "),e.scheduleId&&e.attachSelected(e.schedules)?r("el-option",{attrs:{label:e.form.data.schedule.user.full_name+" "+e.form.data.schedule.excursion.time,value:e.form.data.schedule.id}}):e._e(),e._v(" "),e._l(e.schedules,(function(e){return r("el-option",{key:e.id,attrs:{label:e.user.full_name+" "+e.excursion.time,value:e.id}})}))],2)],1),e._v(" "),r("el-row",{attrs:{gutter:20}},[r("el-col",{attrs:{span:12}},[r("el-form-item",{staticClass:"mb-0",attrs:{label:e.$t("Check in"),for:"check_in",error:e.form.formatErrors("arrived_waiting_room")}},[r("el-switch",{attrs:{id:"check_in",disabled:!!e.form.data.schedule_id},on:{change:e.autoAssign},model:{value:e.form.data.arrived_waiting_room,callback:function(t){e.$set(e.form.data,"arrived_waiting_room",t)},expression:"form.data.arrived_waiting_room"}})],1)],1),e._v(" "),r("el-col",{attrs:{span:12}},[e.isChanged?r("el-form-item",{staticClass:"mb-0",attrs:{label:e.$t("Add comment")}},[r("el-switch",{model:{value:e.commentForm,callback:function(t){e.commentForm=t},expression:"commentForm"}})],1):e._e()],1)],1),e._v(" "),e.isChanged?[e.commentForm?r("el-form-item",{staticClass:"mt-20",attrs:{error:e.form.formatErrors("comment")}},[r("el-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:4},placeholder:"Insert comment"},model:{value:e.form.data.comment,callback:function(t){e.$set(e.form.data,"comment",t)},expression:"form.data.comment"}})],1):e._e(),e._v(" "),r("v-divider"),e._v(" "),r("el-button",{attrs:{type:"success","native-type":"submit"}},[e._v(e._s(e.$t("Apply"))+"\n        ")])]:e._e()],2)}),[],!1,null,null,null).exports,u=r(248);function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function p(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var f={mixins:[s.b,s.c],components:{ProcessForm:m,VCommentsList:u.a},data:function(){return{model:null,comments:[],isProcessing:!1,formData:null}},beforeRouteEnter:function(e,t,r){return r((function(e){return e.lock(e.view())}))},beforeRouteUpdate:function(e,t,r){e.params.bookingId!==t.params.bookingId&&this.lock(this.view(e.params.bookingId)),r()},computed:{backRoute:function(){var e={name:"bookings.list"};switch(this.$router.currentRoute.name){case"waiting-room.view":e.name="waiting-room.list";break;case"forecasting.view":e.name="forecasting.list";break;case"bookings.roster-bookings.view":e.name="bookings.roster-bookings";break;case"processed.view":e.name="processed.list";break;case"rostered.view":e.name="rostered.list"}return e},editMode:function(){return!this.model.schedule_id}},methods:function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(r,!0).forEach((function(t){p(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({isOptionActive:function(e){return!!this.model.ticket_options.length&&(!(this.model.schedule&&this.model.schedule.disabled_options&&this.model.schedule.disabled_options.includes(e.id))&&!!this.model.ticket_options.find((function(t){return t.tour_option.id==e.id&&t.tour_option.is_active})))},toggleProcessMode:function(){this.isProcessing=!this.isProcessing}},Object(o.mapActions)("bookings",{view:function(e){var t,r,o=arguments;return regeneratorRuntime.async((function(s){for(;;)switch(s.prev=s.next){case 0:return t=o.length>1&&void 0!==o[1]?o[1]:null,s.next=3,regeneratorRuntime.awrap(e("view",{bookingId:t||this.$routeParam("bookingId")}));case 3:r=s.sent,this.$data.model=r.view,this.formData=r.view,this.comments=r.comments;case 7:case"end":return s.stop()}}),null,this)},processBooking:function(e,t){var r;return regeneratorRuntime.async((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,regeneratorRuntime.awrap(e("process",{bookingId:this.$routeParam("bookingId"),form:t}));case 2:return r=o.sent,o.next=5,regeneratorRuntime.awrap(t.setData(r.view));case 5:this.formData=r.view,this.$data.model=r.view,this.comments=r.comments,this.$ee.emit("bookings@list.fetch");case 9:case"end":return o.stop()}}),null,this)}}))},b=Object(c.a)(f,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-sidebar-layout",{attrs:{locked:e.locked},scopedSlots:e._u([{key:"header",fn:function(){return[r("v-sidebar-layout-header",{attrs:{title:e.$t("Booking detail page"),"back-route":e.backRoute},scopedSlots:e._u([{key:"right",fn:function(){return[e.editMode&&e.$can("bookings.edit")?r("router-link",{staticClass:"btn",attrs:{to:{name:"bookings.edit",params:{bookingId:e.$routeParam("bookingId")}},title:e.$t("Edit"),"aria-label":e.$t("Edit")}},[r("i",{staticClass:"icon fal fa-edit"})]):e._e()]},proxy:!0}])})]},proxy:!0},{key:"body",fn:function(){return[r("v-form-preview",{staticClass:"mb-15",attrs:{label:e.noLabels?null:e.$t("Tour")}},[r("router-link",{key:e.model.tour.id,style:"margin-left: 0px",attrs:{to:{name:"tours.view",params:{tourId:e.model.tour.id}},exact:""}},[e._v("\n                    "+e._s(e.model.tour.name)+"\n            ")])],1),e._v(" "),e.isGuide?e._e():r("v-form-preview",{staticClass:"mb-15",attrs:{label:e.$t("Booking number"),value:e.model.booking_number}}),e._v(" "),e.model.tour.tour_options.length?r("v-form-preview",{staticClass:"mb-15",attrs:{label:e.noLabels?null:e.$t("Options")}},e._l(e.model.tour.tour_options,(function(t){return r("div",{key:e.model.id+"_"+t.id},[r("i",{class:[e.isOptionActive(t)?"u-color-success fal fa-check":"u-color-danger fal fa-times"],staticStyle:{"min-width":"15px"}}),e._v(" \n                "+e._s(t.name)+"\n            ")])})),0):r("v-form-preview",{staticClass:"mb-15",attrs:{label:e.noLabels?null:e.$t("Options"),noValue:e.$t("No additional options")}}),e._v(" "),r("v-form-preview",{staticClass:"mb-15",attrs:{label:e.noLabels?null:e.$t("Event time"),value:e.model.start_at_full}}),e._v(" "),r("el-collapse",{staticClass:"mb-10"},[r("el-collapse-item",{attrs:{name:"1"}},[r("template",{slot:"title"},[r("label",{staticClass:"el-form-item__label"},[e._v(e._s(e.model.first_name)+" "+e._s(e.model.last_name))])]),e._v(" "),r("el-row",{staticStyle:{"margin-bottom":"-30px"},attrs:{gutter:20}},[r("el-col",{attrs:{span:12}},[r("v-form-preview",{staticClass:"mb-15",attrs:{label:e.$t("Phone"),value:e.model.phone}})],1),e._v(" "),r("el-col",{attrs:{span:12}},[r("v-form-preview",{staticClass:"mb-15",attrs:{label:e.$t("Email"),value:e.model.email}})],1)],1)],2)],1),e._v(" "),r("el-row",{staticClass:"pl-5"},e._l(e.model.booking_tickets,(function(t){return r("el-col",{key:e.model.id+"_"+t.id,attrs:{span:8}},[r("v-form-preview",{staticClass:"mb-10",attrs:{label:t.ticket.name}},[e._v("\n                    "+e._s(t.quantity)+" "+e._s(e.$t("tickets"))+"\n                ")])],1)})),1),e._v(" "),e.isGuide?e._e():[r("v-divider",{attrs:{hrClass:"mb-10 mt-0"}}),e._v(" "),r("el-row",[r("el-col",{attrs:{span:8}},[r("span",{staticClass:"c-form-preview__label",staticStyle:{display:"contents"}},[e._v(e._s(e.$t("Total price")))])]),e._v(" "),r("el-col",{attrs:{span:8}},[r("v-form-preview",{staticClass:"mb-10"},[r("b",[e._v(e._s(e.model.total_price)+" "+e._s(e.model.tour.currency))])])],1),e._v(" "),e.model.start_total_price!=e.model.total_price?r("el-col",{attrs:{span:8}},[r("v-form-preview",{staticClass:"mb-10 c-form-preview__label"},[r("b",[r("strike",[e._v(e._s(e.model.start_total_price)+" "+e._s(e.model.tour.currency))])],1)])],1):e._e()],1)],e._v(" "),r("v-divider",{attrs:{hrClass:"mb-10 mt-0"}}),e._v(" "),r("v-form",{ref:"form",attrs:{data:e.formData,name:"booking"},on:{submit:e.processBooking},scopedSlots:e._u([{key:"default",fn:function(e){var t=e.form,o=e.submit;return[r("process-form",{attrs:{form:t},on:{submit:o}})]}}])})]},proxy:!0},{key:"footer",fn:function(){return[e.comments.length?r("v-comments-list",{attrs:{items:e.comments}}):e._e()]},proxy:!0}])})}),[],!1,null,null,null);t.default=b.exports},248:function(e,t,r){"use strict";var o={props:{items:{type:Array,required:!0}}},s=r(1),i=Object(s.a)(o,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-timeline",{staticClass:"pl-0"},[e._l(e.items,(function(t){return r("el-timeline-item",{key:t.id},[e._v("\n       "+e._s(t.comment)+"\n       "),r("p",{staticStyle:{color:"#7d878a"}},[r("span",[e._v(e._s(t.created_at))]),e._v(" "),r("b",[e._v(e._s(t.first_name)+" "+e._s(t.last_name))])])])})),e._v(" "),r("el-timeline-item",[e._v(" ")])],2)}),[],!1,null,null,null);t.a=i.exports}}]);